package library;

import library.book.Book;
import library.book.BookRepository;
import library.users.UserRepository;
import library.users.User;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.CommandLineRunner;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
class LoadDatabase {

    private static final Logger log = LoggerFactory.getLogger(LoadDatabase.class);

    @Bean
    CommandLineRunner initDatabase(BookRepository bookRepository, UserRepository userRepository) {

        User user1 = new User("Mattia99", "12345", "ROLE_USER", 0F);
        User user2 = new User("Giorgio99", "ciao", "ROLE_ADMIN", 0F);

        Book book1 = new Book(123456,"Le tigri di Mompracem", "Emilio Salgari", "Romanzo", 1900, 10, 2.5F);
        Book book2 = new Book(121212,"1984", "George Orwell", "Romanzo", 1949, 15, 1.5F);

        user1.getRentedBook().add(book1);
        user1.getRentedBook().add(book2);
        user2.getRentedBook().add(book2);

        book1.getUsers().add(user1);
        book2.getUsers().add(user2);
        book2.getUsers().add(user1);

        return args -> {
            log.info("Preloading " + bookRepository.save(book1));
            log.info("Preloading " + bookRepository.save(book2));

            log.info("Preloading " + userRepository.save(user1));
            log.info("Preloading " + userRepository.save(user2));

        };
    }
}